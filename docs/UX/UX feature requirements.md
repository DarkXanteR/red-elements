# Node RED v2

## UI/UX feature requirements

## Main models

- user sessions (login/logout via OAuth 2)
- projects
- environments
- workspaces
- flows
- nodes
- teams
- users
- audience (an audience you can share artifacts with)

### Settings

Settings will work at a hierarchical/granular level. You can have

- default settings
- project settings
- environment settings
- workspace settings

Each settings level will inherit settings from more general level, that it can then override. Settings will be a simple key/value mapping, that can be stored in any key/value storage such as local storage, Redis DB (on server) or similar. We can import settings from a JSON or YAML file.

Hierarchical settings (with "inheritance") will work, by having a settings instance for each container (project, environment etc). A settings instance is generated by merging all settings at higher levels on top of each other into a new object settings instance.

Settings:

- `editorTheme` (name)
- `libraryProviders` (list of endpoint to provide libraries)
- `deployment` (deployment config)
- ...

## Main UI elements

- Canvas
- Palette (of elements to add to canvas: typically nodes or flows)
- Node Editor
- Run Display (console) (show results from running a flow)
- Libraries (of reusable palette elements)

### User sessions

- User sessions via social login using [0Auth](https://oauth.io/)
  - Github
  - Google
  - Facebook
  - Twitter

### Projects

A user will always be working in a project. Artifacts can be moved, exchanged and reused between projects. A project can be shared and worked on collaboratively.

Main project operations:

- New project
- Edit project
- Delete project
- Share project
- List projects (manage projects, filter/search and container relationships via tagging)

#### Project List view

The list view should make it easy to manage projects, such as quickly adding an environment to one or more projects.

Select one or more project in list view. Click add environments, select environments to add to each of selected projects.

#### Project

- name
- version
- description
- ...

Containments and refs:

- 0..n environments

A project can contain one or more `environments`.
A new project contains (or has) a default environment:

- name: `default`
- type: `development`

To make it easy to assign environments, we should avoid a nested hierarchy.
Instead we will control such "memberships" using tags. This makes it more flexible/extensible, easy to search etc.

The active project should always display the tags for each environment it references (via tags)

- thick border if currently active
- environment name
- environment type color

Clicking on an environment tag should switch to that environment, with all workspaces for it

### Audiences

Main audience operations:

- New audience
- Edit audience
- Delete audience
- List audiences

You can add the following to an audience:

- user by email (set permission level: `read`, `comment`)
- team
- user
- audience (build larger audience by merging audience groups)

When merging audiences, some members might be in one or more of the groups merged.

Such members will by default have the lowest level of permission allowed in any of the audiences he/she belongs to. This can then be upgraded/downgraded in the new audience instance

Teams added to an audience will also be added virtually, so that any team change will result in an event that an generate notifications to users that have their audience settings changed or different contexts.

#### Audience List view

The list view should make it easy to manage audiences, such as quickly adding an audience members to one or more audiences.

Select one or more audiences in list view. Click add audience members, select members to add to each of selected audiences.

#### Audience

- name
- type
- version
- description
- ...
- share settings

Containments and refs:

- virtual user (name/email only)
- user
- team

Social:

- slack id

#### Share settings

Global

- read (view only)
- comment (make comments)
- run (allow user to run flows and see results)

In future releases we might allow for more granular settings.
For a shared project, a user could have different permissions for specific:

- environments
- workspaces

Shared projects will not allows an audience to edit anything in the shared artifacts, except for adding comments. To have edit permission, the user must be logged in and be a member of the author group for that project (or artifact?)

### Environments

Main environment operations:

- New environment
- Edit environment
- Delete environment
- Share environment
- List environments (manage workspaces, filter/search and container relationships via tagging)

#### Environment

- name
- type
- version
- description
- ...

Containments and refs:

- 0..n deployment targets

Social:

- slack id

An environment is referenced by one or more projects (via tags)
An environment has a color for its type:

- development (gray)
- test (light blue)
- staging (blue)
- production (green)


An environment can contain one or more workspaces.
A new environment contains one default workspace:

- name: `my workspace`

#### Environments List view

The environments list view should make it easy to manage environments, such as:

- add environments to one or more projects
- add workspaces to one or more environments
- merge environments

Add selected environments to multiple projects:

- Select one or more environments in list view.
- Click `add to projects`
- select projects to add to each of selected environments to (by tag/ref)

Add workspaces to selected environments:

- Select one or more environments in list view.
- Click `add workspaces`
- Select workspaces to added to each of selected environments (by tag/ref)

Add deployment targets to selected environments:

- Select one or more environments in list view.
- Click `add deployment targets`
- Select deployment targets to add to each of selected environments (by tag/ref)

#### Environment deployments config

An environment can be configured to make deployments to one or more backends which deploy to a repo.

The first release will only have Git repo integration with some of the most popular Git hosting providers for which we have Node APIs:

- [github](github.com/)
- [bitbucket](https://bitbucket.org) by [Atlassian](atlassian.com) (known for JIRA etc.)

Backends will be pluggable/extensible in future releases.

### Deployment targets

Main deployment target operations:

- New deployment target
- Edit deployment target
- Delete deployment target
- List deployment targets

Add environments to selected deployment targets:

- Select one or more deployment targets in list view.
- Click `add environment`
- Select environment to add to each of selected deployment targets (by tag/ref)

the inverse relationship should be achievable in same fashion (ie. from environments list view)

### Deployment target

- name
- version
- description
- git endpoint (url)
- git repo type (`bitbucket` or `github`)
- git credentials (usually a JWT token or username/password)

### Workspaces

- New workspace
- Edit workspace
- Delete workspace
- List workspaces (manage workspaces, filter/search and container relationships via tagging)
- Share workspace

Workspaces are (traditionally/currently) shown as tabs on the canvas.
We need to make this more scalable and flexible.

We should have a separate workspaces display in a list view, that allow search and filtering for workspaces and where you can quickly control which workspaces are to be currently "active" (ie. added to editor with tabs/canvas).

We should have this listing for projects and environments as well. The listing view should also make it easy to move artifacts around, such as tagging a workspace to be part of another environment or project.

Workspace operations:

- Add/remove flow
- Add/remove node

We should make it easy to collapse (merge) distinct workspaces and to make a workspace for a subflow of a given flow in a workspace

#### Workspace

- name
- version
- description
- ...
- slack id

Containments and refs:

- 0..n flows
- 0..n nodes (part of each flow)
- 0..n node types (typs of nodes used)
- node type dependencies

#### Node dependencies

Each Node types can have its own dependencies. Each workspace can use this metadata to list all dependencies. Dependencies can only be resolved against remote node module providers/registries such as git repos and `npm` registries.

PS: Not sure how we can use private npm registries or repos.

### Teams

A project always has exactly one team with project members

- New team
- Edit team
- Delete team

Operations:

- Add user to team
- Remove user from team
- Add team to team
- Remove team from team
- Add team to project, environment or workspace
- Remove team from project, environment or workspace

Note that when adding a team to a team, the team should be added "virtually", ie. the team membership should always be calculated on-demand, not resolved staticly on addition. This means that if user is removed or otherwise changes status on a team, it will instantly be relfected on all other teams he is a (virtual) member of.

#### Team

- name
- main role (from set of roles)
- version
- description
- slack id
- ...
- teamMembers: TeamMember[]

#### TeamMember

A TeamMember references a user, but assigns specific roles and permissions in relation to the specific team membership. This allows each membership to override default user permissions and roles.

### Users

- New user
- Edit user
- Delete user

#### User

- name
- role (default role from set of roles)
- email
- version
- description
- ...

social:

- slack id
- twitter id
- skype id
- google id (For Google Hangouts etc.)

A user can be added to one or more user containers such as a team, or audience.
The user is added as a new instance and can change his role/permissions for that instance.

### Flows

A flow consists of:

- 0..n nodes
- 0..n subflows

A subflow is a composite node

#### Flow

- name
- version
- description

Containments and refs:

- 0..n nodes

### Nodes

- Add node to flow (canvas)
- Remove node from flow (canvas)
- Edit node (via Node Editor)

#### Node

- name
- type
- label (displayed)
- tags (for search)
- version
- description
- 0..n custom properties

#### Node type

A node type can be a member of one or more Node categories

- categories

#### Node category

- name
- description

A Node category could be:

- IO
- test
- config
- ...

The palette should allow for displaying/searching on node types that belong to specific categories. A project, environment or workspace should have a setting to filter palette for the categories that best suit it

#### Node properties

- name
- type
- categories (via node type)
- label (displayed)
- tags (for search)
- version
- description
- 0..n custom properties

